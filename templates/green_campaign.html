 
{% extends 'base.html' %}
{% load static %}

{% block title %}Green Movement{% endblock %}
 
{% block hero %} 
<section class="hero-container">
  <!-- Background Image -->
  <div class="hero-background">
    <img
      src="{% static 'assets/img/about_us_hero.jpg' %}"
      alt="Green Future Society promoting sustainable agriculture and forestry in Kenya"
      class="hero-image"
    />
    <div class="hero-overlay"></div>
  </div>

  <!-- Floating Particles -->
  <div class="floating-particles">
    <!-- You can dynamically add particles using JS if needed -->
    {% for _ in particle_range %}
    <div class="particle"></div>
    {% endfor %}
  </div>

  <!-- Main Content -->
  <div class="hero-content">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-8">
          <div class="hero-text">
            <br />
            <br />  
            <br />
            <h1 class="hero-title animate-fade-up">G.F.S</h1>
            <div class="cta-container animate-fade-up-delay-2">
              <a href="/" class="btn-secondary-custom" aria-label="Discover More about Our Services">
                <i class="fas fa-play-circle"></i> Home
              </a>
              <a href="/green-campaign" class="btn-primary-custom" aria-label="Start Your Green Journey">
                <i class="fas fa-leaf"></i> Green Campaign
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- How We Achieve Our Objectives (Photo-Based Activities Section) -->
<section class="py-5">
  <div class="container">
    <h2 class="fw-bold mb-4 text-success text-center">Our Key Activities</h2>
    <div class="row g-4">

   <!-- Activity 1 -->
<div class="col-md-6 col-lg-4">
  <div class="card h-100 shadow-sm border-0">
    <img src="{% static 'assets/img/tree_nursery.jpg' %}" class="card-img-top" alt="Tree Nursery Management">
    <div class="card-body">
      <h5 class="card-title text-success">Tree Nursery Management</h5>
      <p class="card-text small">Training communities & growing seedlings.</p>

      <!-- Read More Modal Trigger -->
      <button class="btn btn-outline-success btn-sm mt-2 me-2" data-bs-toggle="modal" data-bs-target="#treeNurseryModal">
        Read More
      </button>
    </div>
  </div>
</div>


     <!-- Activity 2 -->
<div class="col-md-6 col-lg-4">
  <div class="card h-100 shadow-sm border-0">
    <img src="{% static 'assets/img/community_awareness.jpg' %}" class="card-img-top" alt="Community Awareness">
    <div class="card-body">
      <h5 class="card-title text-success">Community Awareness</h5>
      <p class="card-text small">Educating communities on sustainability.</p>
      <button class="btn btn-outline-success btn-sm mt-2" data-bs-toggle="modal" data-bs-target="#communityAwarenessModal">
        Read More
      </button>
    </div>
  </div>
</div>


      <!-- Activity 3 -->
<div class="col-md-6 col-lg-4">
  <div class="card h-100 shadow-sm border-0">
    <img src="{% static 'assets/img/youth _education.jpg' %}" class="card-img-top" alt="Tree Donations">
    <div class="card-body">
      <h5 class="card-title text-success">Tree Donations</h5>
      <p class="card-text small">Donating seedlings & offering support.</p>

      <!-- Read More Modal Trigger -->
      <button class="btn btn-outline-success btn-sm mt-2 me-2" data-bs-toggle="modal" data-bs-target="#treeDonationsModal">
        Read More
      </button>
    </div>
  </div>
</div>


      <!-- Activity 4 -->
<div class="col-md-6 col-lg-4">
  <div class="card h-100 shadow-sm border-0">
    <img src="{% static 'assets/img/alumni_program.jpg' %}" class="card-img-top" alt="Alumni Afforestation Programs">
    <div class="card-body">
      <h5 class="card-title text-success">Alumni Afforestation</h5>
      <p class="card-text small">Partnering with schools & alumni.</p>

      <!-- Read More Modal Trigger -->
      <button class="btn btn-outline-success btn-sm mt-2 me-2" data-bs-toggle="modal" data-bs-target="#alumniAfforestationModal">
        Read More
      </button>
    </div>
  </div>
</div>


    <!-- Activity 5 -->
<div class="col-md-6 col-lg-4">
  <div class="card h-100 shadow-sm border-0">
    <img src="{% static 'assets/img/community_cleanups.jpg' %}" class="card-img-top" alt="Community Clean-Ups">
    <div class="card-body">
      <h5 class="card-title text-success">Community Clean-Ups</h5>
      <p class="card-text small">Cleaning public spaces & planting trees.</p>

      <!-- Read More Modal Trigger -->
      <button class="btn btn-outline-success btn-sm mt-2 me-2" data-bs-toggle="modal" data-bs-target="#communityCleanupsModal">
        Read More
      </button>
    </div>
  </div>
</div>

    </div>
  </div>
{% endblock hero %}
{% block content %}
<!-- Tree Nursery Management Modal -->
<div class="modal fade" id="treeNurseryModal" tabindex="-1" aria-labelledby="treeNurseryModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="treeNurseryModalLabel">Tree Nursery Management</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <img src="{% static 'assets/img/tree_nursery.jpg' %}" class="img-fluid mb-3 rounded" alt="Tree Nursery Management">
        <p><strong>Detailed Overview:</strong></p>
        <p>Through Tree Nursery Management, we train communities to establish and manage tree nurseries that provide quality seedlings for reforestation and community greening projects. This program supports sustainable agriculture and environmental conservation.</p>
        <ul>
          <li>Seedling production training</li>
          <li>Tree species selection and care</li>
          <li>Community-managed nurseries</li>
          <li>Support for reforestation efforts</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Community Awareness Modal -->
<div class="modal fade" id="communityAwarenessModal" tabindex="-1" aria-labelledby="communityAwarenessModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="communityAwarenessModalLabel">Community Awareness</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <img src="{% static 'assets/img/community_awareness.jpg' %}" class="img-fluid mb-3 rounded" alt="Community Awareness">
        <p><strong>Detailed Overview:</strong></p>
        <p>Our Community Awareness program focuses on educating individuals and groups about sustainability, environmental conservation, and green living practices. Through workshops, local events, and direct engagement, we spread the knowledge needed to create lasting change.</p>
        <ul>
          <li>Environmental education workshops</li>
          <li>Community engagement and forums</li>
          <li>Collaboration with schools and local leaders</li>
          <li>Distribution of educational materials</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Tree Donations Modal -->
<div class="modal fade" id="treeDonationsModal" tabindex="-1" aria-labelledby="treeDonationsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="treeDonationsModalLabel">Tree Donations</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <img src="{% static 'assets/img/tree_donations.jpg' %}" class="img-fluid mb-3 rounded" alt="Tree Donations">
        <p><strong>Detailed Overview:</strong></p>
        <p>Through our Tree Donations program, we accept seedlings, monetary donations for tree planting, and other forms of support to help communities engage in reforestation and sustainable farming initiatives.</p>
        <ul>
          <li>Donate seedlings to communities in need</li>
          <li>Support tree planting events financially</li>
          <li>Provide tools and resources for tree growth</li>
          <li>Partner with schools and local groups</li>
        </ul>
      </div>
    </div>
  </div>
</div>
<!-- Alumni Afforestation Modal -->
<div class="modal fade" id="alumniAfforestationModal" tabindex="-1" aria-labelledby="alumniAfforestationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="alumniAfforestationModalLabel">Alumni Afforestation Programs</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <img src="{% static 'assets/img/alumni_program.jpg' %}" class="img-fluid mb-3 rounded" alt="Alumni Afforestation Programs">
        <p><strong>Detailed Overview:</strong></p>
        <p>Our Alumni Afforestation Program collaborates with schools, alumni groups, and local communities to drive tree planting and conservation efforts, strengthening long-term environmental impact.</p>
        <ul>
          <li>Organize tree planting events with alumni</li>
          <li>Promote environmental awareness in schools</li>
          <li>Provide seedlings and planting materials</li>
          <li>Establish school-based green clubs</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Community Clean-Ups Modal -->
<div class="modal fade" id="communityCleanupsModal" tabindex="-1" aria-labelledby="communityCleanupsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="communityCleanupsModalLabel">Community Clean-Ups</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <img src="{% static 'assets/img/community_cleanups.jpg' %}" class="img-fluid mb-3 rounded" alt="Community Clean-Ups">
        <p><strong>Detailed Overview:</strong></p>
        <p>Our Community Clean-Ups bring together volunteers to clean public spaces, remove waste, and plant trees to restore green areas. These activities promote sustainable living and encourage community ownership of the environment.</p>
        <ul>
          <li>Public park clean-ups</li>
          <li>Street and beach cleaning initiatives</li>
          <li>Tree planting in cleaned areas</li>
          <li>Educational sessions on waste management</li>
        </ul>
      </div>
    </div>
  </div>
</div>
</section>


<!-- Tree Cover Map Section -->
<section class="map-section py-6 bg-white" aria-labelledby="map-heading">
  <div class="container">
    <div class="row justify-content-center text-center mb-4">
      <div class="col-lg-10">
        <span class="badge brand-badge mb-3 px-4 py-2 rounded-pill">Our Green Footprint</span>
        <h2 id="map-heading" class="display-5 fw-bold text-dark mb-3">
          Roadmap to <span class="brand-highlight">restoration</span>
        </h2>
        <p class="lead text-muted mb-4">
          Visualizing Kenya's forest coverage as part of our mission to grow tree cover from 
          <strong>12% today</strong> to <strong>30% by 2030</strong>.
        </p>
        
        <!-- Mission Counties Alert -->
        <div class="alert alert-warning border-0 shadow-sm mb-4" role="alert" style="background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); border-left: 4px solid #856404;">
          <div class="d-flex align-items-center">
            <i class="fas fa-exclamation-triangle text-warning me-3 fs-4"></i>
            <div class="text-start">
              <h5 class="alert-heading mb-2">🎯 Priority Focus Areas</h5>
              <p class="mb-0">
                <strong>9 counties</strong> identified with critically low tree coverage (&lt;9%) requiring immediate intervention. 
                These areas face severe climate risks and ecosystem degradation.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Mission Counties Statistics Row -->
    <div class="row mb-5">
      <div class="col-12">
        <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
          <div class="card-body py-4">
            <div class="row text-center">
              <div class="col-6 col-md-3">
                <div class="border-end border-2 border-light">
                  <h3 class="display-6 fw-bold text-danger mb-1">3</h3>
                  <p class="text-muted mb-0 small">Critical Priority<br><span class="badge bg-danger">&lt;5% Cover</span></p>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="border-end border-2 border-light">
                  <h3 class="display-6 fw-bold text-warning mb-1">5</h3>
                  <p class="text-muted mb-0 small">High Priority<br><span class="badge bg-warning">5-9% Cover</span></p>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="border-end border-2 border-light">
                  <h3 class="display-6 fw-bold text-primary mb-1">5.8%</h3>
                  <p class="text-muted mb-0 small">Average Coverage<br><span class="text-muted">Mission Counties</span></p>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <h3 class="display-6 fw-bold text-success mb-1">30%</h3>
                <p class="text-muted mb-0 small">2030 Target<br><span class="badge bg-success">+24.2% Needed</span></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="row">
      <div class="col-12">
        <!-- Map Container -->
        <div class="position-relative">
          <div id="kenyaMap" style="height: 600px; border-radius: 12px; overflow: hidden; border: 3px solid #e9ecef;"></div>
          
          <!-- Map Instructions Overlay -->
          <div class="position-absolute top-0 end-0 m-3" style="z-index: 1000;">
            <div class="card border-0 shadow-sm" style="background: rgba(255, 255, 255, 0.95); max-width: 250px;">
              <div class="card-body p-3">
                <h6 class="card-title mb-2 text-dark">
                  <i class="fas fa-info-circle text-primary me-2"></i>Interactive Map
                </h6>
                <ul class="list-unstyled mb-0 small text-muted">
                  <li><i class="fas fa-mouse-pointer me-2 text-success"></i>Click counties for details</li>
                  <li><i class="fas fa-search me-2 text-info"></i>Zoom to explore regions</li>
                  <li><i class="fas fa-bullseye me-2 text-danger"></i>Red = Priority areas</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Mission Counties Quick Reference -->
        <div class="mt-4">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-transparent border-0 pb-0">
              <h5 class="mb-0 text-dark">
                <i class="fas fa-map-marked-alt me-2 text-danger"></i>
                Mission Priority Counties
              </h5>
            </div>
            <div class="card-body pt-3">
              <div class="row g-3">
                <!-- Northern Region -->
                <div class="col-md-4">
                  <div class="border-start border-4 border-danger ps-3">
                    <h6 class="text-danger fw-bold mb-2">Northern Counties</h6>
                    <div class="small text-muted">
                      <div class="d-flex justify-content-between mb-1">
                        <span>Marsabit</span>
                        <span class="badge bg-danger">2.06%</span>
                      </div>
                      <div class="d-flex justify-content-between mb-1">
                        <span>Mandera</span>
                        <span class="badge bg-danger">3.61%</span>
                      </div>
                      <div class="d-flex justify-content-between">
                        <span>Wajir</span>
                        <span class="badge bg-danger">4.45%</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Western Region -->
                <div class="col-md-4">
                  <div class="border-start border-4 border-warning ps-3">
                    <h6 class="text-warning fw-bold mb-2">Western Counties</h6>
                    <div class="small text-muted">
                      <div class="d-flex justify-content-between mb-1">
                        <span>Siaya</span>
                        <span class="badge bg-warning">5.27%</span>
                      </div>
                      <div class="d-flex justify-content-between mb-1">
                        <span>Kisumu</span>
                        <span class="badge bg-warning">8.85%</span>
                      </div>
                      <div class="d-flex justify-content-between">
                        <span>Busia</span>
                        <span class="badge bg-warning">8.39%</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Eastern & Coastal -->
                <div class="col-md-4">
                  <div class="border-start border-4 border-info ps-3">
                    <h6 class="text-info fw-bold mb-2">Eastern & Coastal</h6>
                    <div class="small text-muted">
                      <div class="d-flex justify-content-between mb-1">
                        <span>Machakos</span>
                        <span class="badge bg-secondary">6.03%</span>
                      </div>
                      <div class="d-flex justify-content-between mb-1">
                        <span>Isiolo</span>
                        <span class="badge bg-secondary">6.7%</span>
                      </div>
                      <div class="d-flex justify-content-between">
                        <span>Taita Taveta</span>
                        <span class="badge bg-secondary">6.87%</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<script>
document.addEventListener("DOMContentLoaded", function () {
    // Initialize map
    var map = L.map('kenyaMap').setView([0.0236, 37.9062], 6);

    // Base layers
    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    });

    var satellite = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap, Humanitarian OSM'
    });

    osm.addTo(map); // default

    // Mission-critical counties with detailed data
    var missionCounties = {
        "Marsabit": {
            treeCover: 2.06,
            forestCover: "Very low",
            priority: "critical",
            reason: "Arid/semi-arid, sparse trees, low rainfall; degradation, climate change risks",
            target: 30,
            region: "Northern"
        },
        "Mandera": {
            treeCover: 3.61,
            forestCover: "Very low",
            priority: "critical",
            reason: "Highly dry region, deforestation, vulnerable ecosystem",
            target: 30,
            region: "Northern"
        },
        "Wajir": {
            treeCover: 4.45,
            forestCover: "Very low",
            priority: "critical",
            reason: "ASAL region (arid and semi-arid lands); drought vulnerability",
            target: 30,
            region: "Northern"
        },
        "Siaya": {
            treeCover: 5.27,
            forestCover: 0.23,
            priority: "critical",
            reason: "Despite rainfall, loss due to human pressure, land conversion",
            target: 30,
            region: "Western"
        },
        "Machakos": {
            treeCover: 6.03,
            forestCover: "Low",
            priority: "high",
            reason: "Population growth, land use change, urbanization reducing tree cover",
            target: 30,
            region: "Eastern"
        },
        "Isiolo": {
            treeCover: 6.7,
            forestCover: "Low",
            priority: "high",
            reason: "ASAL, degraded lands, droughts, pastoralism pressures",
            target: 30,
            region: "Eastern"
        },
        "Kisumu": {
            treeCover: 8.85,
            forestCover: 0.44,
            priority: "high",
            reason: "Lake Victoria Basin counties, high human activity, low forest in catchments",
            target: 30,
            region: "Western"
        },
        "Busia": {
            treeCover: 8.39,
            forestCover: 0.53,
            priority: "high",
            reason: "Rainfall adequate but human land use has cut forest cover dramatically",
            target: 30,
            region: "Western"
        },
        "Taita Taveta": {
            treeCover: 6.87,
            forestCover: "Moderate",
            priority: "medium",
            reason: "Used for agriculture, but also near some forested/coastal/mountain regions. Potential to restore",
            target: 30,
            region: "Coast"
        }
    };

    // Other counties with general data
    var otherCounties = {
        "Kakamega": {treeCover: 18, target: 30, priority: "low"},
        "Nairobi": {treeCover: 15, target: 30, priority: "medium"},
        "Mombasa": {treeCover: 5, target: 30, priority: "high"},
        "Nakuru": {treeCover: 12, target: 30, priority: "medium"},
        "Kiambu": {treeCover: 14, target: 30, priority: "medium"}
    };

    // Color scheme based on priority and tree cover
    function getColor(county, treeCover, priority) {
        if (missionCounties[county]) {
            // Special colors for mission counties
            switch(priority) {
                case 'critical': return '#8B0000'; // Dark red
                case 'high': return '#FF4500';     // Orange red
                case 'medium': return '#FF8C00';   // Dark orange
                default: return '#FFA500';        // Orange
            }
        } else {
            // Regular color scheme for other counties
            return treeCover > 20 ? '#006400' :
                   treeCover > 10 ? '#66bb66' :
                   treeCover > 5  ? '#c2e699' :
                                    '#f2f0f7';
        }
    }

    function style(feature) {
        let county = feature.properties.COUNTY || feature.properties.NAME_1;
        let data = missionCounties[county] || otherCounties[county];
        let treeCover = data?.treeCover || 0;
        let priority = data?.priority || 'low';
        
        return {
            fillColor: getColor(county, treeCover, priority),
            weight: missionCounties[county] ? 3 : 1,
            color: missionCounties[county] ? '#ffffff' : '#888888',
            dashArray: missionCounties[county] ? '0' : '3',
            fillOpacity: 0.8,
            className: missionCounties[county] ? 'mission-county' : 'regular-county'
        };
    }

    function onEachFeature(feature, layer) {
        let county = feature.properties.COUNTY || feature.properties.NAME_1;
        let missionData = missionCounties[county];
        let otherData = otherCounties[county];
        
        let popupContent = `<div style="max-width: 300px; font-family: Arial, sans-serif;">`;
        
        if (missionData) {
            // Enhanced popup for mission counties
            popupContent += `
                <h4 style="color: #8B0000; margin: 0 0 10px 0; border-bottom: 2px solid #8B0000; padding-bottom: 5px;">
                    🎯 ${county} County
                </h4>
                <div style="background: #fff3f3; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                    <strong>🌲 Tree Coverage:</strong> ${missionData.treeCover}%<br>
                    <strong>🌳 Forest Cover:</strong> ${typeof missionData.forestCover === 'number' ? missionData.forestCover + '%' : missionData.forestCover}<br>
                    <strong>🎯 Target:</strong> ${missionData.target}%<br>
                    <strong>📍 Region:</strong> ${missionData.region}<br>
                    <strong>⚠️ Priority:</strong> <span style="color: ${missionData.priority === 'critical' ? '#8B0000' : '#FF4500'}; font-weight: bold; text-transform: uppercase;">${missionData.priority}</span>
                </div>
                <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; border-left: 4px solid #8B0000;">
                    <strong>Why It Needs More Trees:</strong><br>
                    <em>${missionData.reason}</em>
                </div>
                <div style="margin-top: 10px; text-align: center;">
                    <small style="color: #666;">🌱 Mission Priority County</small>
                </div>
            `;
        } else if (otherData) {
            // Standard popup for other counties
            popupContent += `
                <h4 style="color: #28a745; margin: 0 0 10px 0;">
                    ${county} County
                </h4>
                <strong>🌳 Tree Cover:</strong> ${otherData.treeCover}%<br>
                <strong>🎯 Target:</strong> ${otherData.target}%<br>
                <strong>📈 Gap to Target:</strong> ${otherData.target - otherData.treeCover}%
            `;
        } else {
            popupContent += `
                <h4>${county} County</h4>
                <p>Tree cover data being assessed...</p>
            `;
        }
        
        popupContent += `</div>`;
        
        layer.bindPopup(popupContent);
        
        // Add hover effects for mission counties
        if (missionData) {
            layer.on('mouseover', function(e) {
                this.setStyle({
                    weight: 5,
                    fillOpacity: 0.9
                });
            });
            
            layer.on('mouseout', function(e) {
                this.setStyle({
                    weight: 3,
                    fillOpacity: 0.8
                });
            });
        }
    }

    // Load and style the counties
    fetch("{% static 'json/kenya_counties.geojson' %}")
        .then(res => res.json())
        .then(data => {
            L.geoJson(data, {
                style: style,
                onEachFeature: onEachFeature
            }).addTo(map);
        })
        .catch(error => {
            console.error('Error loading GeoJSON:', error);
            // Fallback: Add some markers for mission counties
            addFallbackMarkers();
        });

    // Fallback function to add markers if GeoJSON fails
    function addFallbackMarkers() {
        const countyCoordinates = {
            "Marsabit": [2.3274, 37.9906],
            "Mandera": [3.9366, 41.8697],
            "Wajir": [1.7471, 40.0573],
            "Siaya": [0.0610, 34.2888],
            "Machakos": [-1.5177, 37.2634],
            "Isiolo": [0.3496, 37.5843],
            "Kisumu": [-0.1022, 34.7617],
            "Busia": [0.4601, 34.1115],
            "Taita Taveta": [-3.3197, 38.3473]
        };

        Object.keys(missionCounties).forEach(county => {
            if (countyCoordinates[county]) {
                const data = missionCounties[county];
                const color = data.priority === 'critical' ? '#8B0000' : '#FF4500';
                
                L.circleMarker(countyCoordinates[county], {
                    radius: 8,
                    fillColor: color,
                    color: '#ffffff',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map).bindPopup(`
                    <strong>${county} County</strong><br>
                    Tree Cover: ${data.treeCover}%<br>
                    Priority: ${data.priority}
                `);
            }
        });
    }

    // Enhanced legend
    var legend = L.control({position: 'bottomright'});
    legend.onAdd = function () {
        var div = L.DomUtil.create('div', 'info legend');
        div.style.cssText = 'background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); font-size: 12px; line-height: 1.4;';
        
        div.innerHTML = `
            <h4 style="margin: 0 0 10px 0; color: #333;">Tree Cover & Mission Priority</h4>
            
            <div style="margin-bottom: 10px;">
                <strong>🎯 Mission Counties:</strong><br>
                <i style="background: #8B0000; width: 18px; height: 18px; display: inline-block; margin-right: 5px; border-radius: 3px;"></i> Critical Priority (0-5%)<br>
                <i style="background: #FF4500; width: 18px; height: 18px; display: inline-block; margin-right: 5px; border-radius: 3px;"></i> High Priority (5-9%)<br>
                <i style="background: #FF8C00; width: 18px; height: 18px; display: inline-block; margin-right: 5px; border-radius: 3px;"></i> Medium Priority (6-7%)<br>
            </div>
            
            <div>
                <strong>🌳 Other Counties:</strong><br>
                <i style="background: #006400; width: 18px; height: 18px; display: inline-block; margin-right: 5px; border-radius: 3px;"></i> 20%+ Tree Cover<br>
                <i style="background: #66bb66; width: 18px; height: 18px; display: inline-block; margin-right: 5px; border-radius: 3px;"></i> 10-20% Tree Cover<br>
                <i style="background: #c2e699; width: 18px; height: 18px; display: inline-block; margin-right: 5px; border-radius: 3px;"></i> 5-10% Tree Cover<br>
                <i style="background: #f2f0f7; width: 18px; height: 18px; display: inline-block; margin-right: 5px; border-radius: 3px;"></i> &lt;5% Tree Cover<br>
            </div>
            
            <div style="margin-top: 10px; padding-top: 8px; border-top: 1px solid #eee; font-size: 11px; color: #666;">
                Target: 30% by 2030
            </div>
        `;
        
        return div;
    };
    legend.addTo(map);

    // Add mission county summary control
    var missionSummary = L.control({position: 'topleft'});
    missionSummary.onAdd = function() {
        var div = L.DomUtil.create('div', 'mission-summary');
        div.style.cssText = 'background: rgba(255, 255, 255, 0.95); padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); max-width: 300px; font-size: 13px;';
        
        const criticalCount = Object.values(missionCounties).filter(c => c.priority === 'critical').length;
        const highCount = Object.values(missionCounties).filter(c => c.priority === 'high').length;
        const avgTreeCover = (Object.values(missionCounties).reduce((sum, c) => sum + c.treeCover, 0) / Object.keys(missionCounties).length).toFixed(1);
        
        div.innerHTML = `
            <h4 style="margin: 0 0 10px 0; color: #8B0000;">🎯 Mission Overview</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 12px;">
                <div style="text-align: center; padding: 8px; background: #fff3f3; border-radius: 4px;">
                    <div style="font-size: 16px; font-weight: bold; color: #8B0000;">${Object.keys(missionCounties).length}</div>
                    <div>Priority Counties</div>
                </div>
                <div style="text-align: center; padding: 8px; background: #f8f9fa; border-radius: 4px;">
                    <div style="font-size: 16px; font-weight: bold; color: #28a745;">${avgTreeCover}%</div>
                    <div>Avg. Tree Cover</div>
                </div>
            </div>
            <div style="margin-top: 8px; font-size: 11px; color: #666;">
                ${criticalCount} Critical • ${highCount} High Priority
            </div>
        `;
        
        return div;
    };
    missionSummary.addTo(map);

    // Layers control
    var baseMaps = {
        "OpenStreetMap": osm,
        "Humanitarian": satellite
    };

    L.control.layers(baseMaps, null, {collapsed: false}).addTo(map);

    // Add custom CSS for mission counties
    var style = document.createElement('style');
    style.textContent = `
        .mission-county {
            cursor: pointer !important;
        }
        .leaflet-popup-content {
            margin: 8px 12px !important;
        }
        .leaflet-popup-content h4 {
            font-size: 16px !important;
        }
    `;
    document.head.appendChild(style);
});
</script>
{% endblock %}